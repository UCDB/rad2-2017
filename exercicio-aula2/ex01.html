<html>

<head>

    <script src="https://unpkg.com/vue"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.4"></script>

</head>


<body>

  
    <div id="app">
    <input type="text" v-model="usuarioNovo.nome"> 
    <button type="button" v-on:click="salvar">Salvar</button>
     <button type="button" v-on:click="novo">Cancelar</button>

       <ul style="list-style-type: none" >
           <li  v-for="(u,index) in usuarios">{{u.id}} {{u.nome}}
                <button type="button" v-on:click="excluir(index)">Excluir</button>
             <button type="button" v-on:click="preparaAlterar(index)">Alterar</button>
           </li>
       </ul>

    </div>

</body>

<script>



var app = new Vue({
  el: '#app',
  data: {
    indiceAlterar:-1,
    usuarioNovo:{nome:""},
    usuarios: []
  },
    mounted:function(){

        this.buscarTodos();
    },
    methods:{
        buscarTodos:function(){
            this.$http.get("http://localhost:8080/usuarios/todos")
                    .then(function(res){
                        this.usuarios = res.body;
                    }, function (res){
                        console.log(res);
                    });

        },
        salvar:function(){

            this.$http.post("http://localhost:8080/usuarios",this.usuarioNovo)
                    .then(function(res){
                        this.usuarioNovo = res.body;

                        if(this.indiceAlterar==-1){
                            this.adicionar();
                        }else {
                            this.alterar();
                            this.indiceAlterar=-1;
                        }
                        this.novo();


                    }, function (res){
                        console.log(res);
                    });



        },
         alterar:function (){
             this.$http.put("http://localhost:8080/usuarios",this.usuarioNovo)
                     .then(function(res) {
                            this.buscarTodos();
                         // this.usuarios.splice(this.indiceAlterar, 1, this.usuarioNovo);
                     }, function (res){
                         console.log(res);
                     });

        },
        adicionar:function(){
            this.usuarios.push(this.usuarioNovo);
           
        },
        excluir :function(i){

            usuarioDel = this.usuarios[i];
            this.$http.delete("http://localhost:8080/usuarios",usuarioDel.id)
                    .then(function(res) {
                        this.buscarTodos();
                        // this.usuarios.splice(this.indiceAlterar, 1, this.usuarioNovo);
                    }, function (res){
                        console.log(res);
                    });
           // window.alert(i);
            //this.usuarios.splice(i,1)
        },
         preparaAlterar :function(i){
           // window.alert(i);
            this.usuarioNovo=  Vue.util.extend({},this.usuarios[i]); 
            this.indiceAlterar=i;
        },
         novo :function(i){
           // window.alert(i);
             this.usuarioNovo={nome:""}
        }
  }
})

</script>


</html>